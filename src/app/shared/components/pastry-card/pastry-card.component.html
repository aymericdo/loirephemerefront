<nz-card [nzCover]="coverTemplate" [nzActions]="[actionCount, actionMinus, actionPlus]"
  [class.-is-admin]="isAdmin">
  <nz-skeleton [nzActive]="true" [nzLoading]="isLoading">
    <nz-badge *ngIf="isStockAvailable" class="stock-badge" [class.-limit-reached]="pastry.stock <= 0"
      [class.-stock-issue]="isStockIssue" nzStandalone nzShowZero [nzCount]="pastry.stock" [nzOverflowCount]="99"
      [nzTitle]="'stock'" i18n-nzTitle>
      <ng-container *ngIf="pastry.stock <= 0">
        <span i18n>Rupture de stock</span>
      </ng-container>
      <ng-container *ngIf="pastry.stock > 0">
        <span i18n>Stock</span>
      </ng-container>
    </nz-badge>

    <nz-badge *ngIf="isAdmin" class="display-sequence-badge" nzStandalone nzShowZero [nzCount]="pastry.displaySequence + 1"
      [nzTitle]="'Séquence d\'affichage'" i18n-nzTitle></nz-badge>

    <nz-card-meta
      [nzTitle]="pastry.name + ' (' + pastry.price + '€)'"
      [nzDescription]="descriptionTemplate">
    </nz-card-meta>

    <ng-template #descriptionTemplate>
      <div nzFlex nz-row>
        <div nz-col nzFlex="1">
          <p class="template-description -mobile" nz-tooltip [nzTooltipTitle]="tooltipTitleTemplate" nzTooltipPlacement="top" [nzTooltipMouseEnterDelay]="1">
            {{ pastry.description.split(' ').splice(0, 20).join(' ') + (pastry.description.split(' ').length > 20 ? '...' : '') }}
          </p>

          <p class="template-description">
            {{ pastry.description }}
          </p>

          <ng-template #tooltipTitleTemplate>
            <ng-container *ngIf="pastry.description.split(' ').length > 20">
              {{ pastry.description }}
            </ng-container>
          </ng-template>

          <nz-collapse *ngIf="pastry.ingredients?.length" class="ingredients-section" nzGhost>
            <nz-collapse-panel nzHeader="Ingrédients" i18n-nzHeader>
              <p class="ingredients" style="margin: 0">
                {{ pastry.ingredients.join(', ') }}
              </p>
            </nz-collapse-panel>
          </nz-collapse>
        </div>

        <img nz-col class="mobile-card-image" *ngIf="!isLoading && imageUrl" [alt]="pastry.name" [src]="imageUrl" (error)="onImgError($event)" />
      </div>
    </ng-template>
  </nz-skeleton>
</nz-card>
<ng-template #coverTemplate>
  <img class="card-image" *ngIf="!isLoading && imageUrl" [alt]="pastry.name" [src]="imageUrl"
    (error)="onImgError($event)" />
  <div *ngIf="isAdmin && !isLoading && imageUrl" class="card-actions-btn">
    <div class="block-btn">
      <button nz-button nzType="default" nzShape="circle" nzSize="large" (click)="clickEdit.emit()"><span nz-icon
          nzType="edit"></span></button>
    </div>
    <div class="block-btn">
      <button *ngIf="!pastry.hidden" nz-button nzType="default" nzShape="circle" nzSize="large"
        (click)="clickDelete.emit()">
        <span nz-icon nzType="eye"></span>
      </button>
      <button *ngIf="pastry.hidden" nzDanger nz-button nzType="primary" nzShape="circle" nzSize="large"
        (click)="clickActive.emit()">
        <span nz-icon nzType="eye-invisible"></span>
      </button>
    </div>
  </div>
</ng-template>
<ng-template #actionCount>
  <span *ngIf="!!count">{{ count }}</span>
</ng-template>
<ng-template #actionPlus>
  <i nz-icon nzType="plus" [class.-disabled]="isMaxLimitReached || isLoading || disabled" (click)="!disabled && !isMaxLimitReached && !isLoading && clickPlus.emit()"></i>
</ng-template>
<ng-template #actionMinus>
  <i nz-icon nzType="minus" [class.-disabled]="count < 1 || isLoading || disabled" (click)="!disabled && count > 0 && !isLoading && clickMinus.emit()"></i>
</ng-template>
